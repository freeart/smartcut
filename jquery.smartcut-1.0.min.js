(function(e,l){function m(a,d,c){if(!c||"number"!==typeof c)c=[0,0];"number"===typeof c&&(c=[c,c]);a=a.sort(function(a,c){return a>c});a=[a[0]-c[0],a[a.length-1]+c[1]];return d>=a[0]&&d<=a[1]}function j(a,d){d=e.extend({baseLength:250,tolerance:10},d||{});d.tailLength===l&&(d.tailLength=Math.min(d.baseLength/2,50));a||(a="");if(!a||!a.length)return[];var a=e.trim(a.replace(/(\s)+/g,"$1")),c=a.indexOf(" ",d.baseLength)||0,b=a.indexOf(".",d.baseLength)||0;return!c?[a.substr(0,d.baseLength),a.substr(d.baseLength)]:a.length<=d.baseLength||a.substr(c).length<=d.tailLength?[a]:b>c&&m([0,d.tailLength],b-c,d.tolerance)?[a.substr(0,b+1),a.substr(b+1)]:[a.substr(0,c),a.substr(c)]}var f={generic:function(){this.toggle()},fade:function(){this.fadeToggle(100)}};e.fn.smartcut=function(a){function d(b){var c=this.data("smartcut"),d=c.$tail,h=c.$ellipsis,g=c.$moreLink;"boolean"!==typeof b&&(b=d.is(":hidden"));b?(b=e.Event("beforeExpand"),this.trigger(b),!1!==b.result&&(h.hide(),g.hide().removeClass(a.moreLinkClass).addClass(a.lessLinkClass).text(a.lessText),a.toggleFn.call(d),a.lessLink&&d.promise().done(function(){a.linkToggleFn.call(g)}))):(b=e.Event("beforeCollapse"),this.trigger(b),!1!==b.result&&(a.toggleFn.call(d),a.linkToggleFn.call(g),d.promise().done(function(){g.removeClass(a.lessLinkClass).addClass(a.moreLinkClass).text(a.moreText);h.show();a.linkToggleFn.call(g)})))}var c;"string"===typeof a&&(c=a,a={});a=e.extend({moreLink:!0,moreLinkClass:"",moreText:"more",lessLink:!0,lessLinkClass:"",lessText:"less",toggleFn:"fade",linkToggleFn:"fade",expanded:!1},a||{});"string"===typeof a.toggleFn&&e.isFunction(f[a.toggleFn])?a.toggleFn=f[a.toggleFn]:e.isFunction(a.toggleFn)||(a.toggleFn=f.generic);"string"===typeof a.linkToggleFn&&e.isFunction(f[a.linkToggleFn])?a.linkToggleFn=f[a.linkToggleFn]:e.isFunction(a.linkToggleFn)||(a.linkToggleFn=f.generic);return this.each(function(){var b=e(this);if(b.is("textarea, input, select, a")||b.children().length&&(!c||!b.data("smartcut")))return true;if(c){b.data("smartcut")&&(c==="expand"&&b.data("smartcut").$tail.is(":hidden")?d.call(b,true):c==="collapse"&&b.data("smartcut").$tail.is(":visible")?d.call(b,false):c==="toggle"&&d.call(b));return true}var f=j(e(this).text(),a);if(f[1]){var k=e("<span></span>"),h=e("<span></span>"),g=e("<span>...</span>"),i=e('<a href="javascript:;"></a>');b.data("smartcut",{$tail:h,$ellipsis:g,$moreLink:i});k.html(f[0]);h.html(f[1]);if(a.expanded===true){i.text(a.lessText).addClass(a.lessLinkClass);g.hide()}else{i.text(a.moreText).addClass(a.moreLinkClass);h.hide();g.show()}i.css("marginLeft",5).click(function(a){a.preventDefault();d.call(b)});b.empty().append(k);f[0][f[0].length-1]!=="."&&b.append(g);b.append(h);a.moreLink===true&&b.append(i)}})};e.smartcut=j})(jQuery);